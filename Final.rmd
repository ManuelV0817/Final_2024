---
title: "Covid91 vaccine study Final2024"
author: "Manuel Villamil"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---


```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
Males = filter(FinalData, sex =="M")
Female = filter(FinalData, sex =="F")
gay = filter(FinalData, LGBTQ =="gay")
Druguser = filter(FinalData, DrugUser =="yes")
```
# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

## Males

## Barplot  

```{r}
dd2 <- Males %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))
# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot illustrates the male population and their outcomes regarding COVID-19 contraction, based on whether they received the vaccine or a placebo. It shows that around 25% of those who were vaccinated still contracted COVID-19, whereas about 65% of those who received the placebo became infected. A significantly higher percentage of individuals who took the placebo contracted the virus compared to those who were vaccinated. These results suggest that the vaccine is effective in providing protection against COVID-19.

## Numerical Results 

```{r}
table1 <- xtabs(~infected + treatment, data=Males)
rowPerc(table1)
colPerc(table1)
```

These figures show the percentages of males who got COVID-19 after receiving either the placebo or the vaccine. Among the male participants, 73.8% who took the placebo became infected, and only about 26.2% of those who received the vaccine got the virus. This data shows that the vaccine is effective in reducing the risk of COVID-19 in males and is therefore recommended. 


### Inferential 

```{r}
chisq.test(table1)
chisqtestGC(table1)
Malesfish <- fisher.test(table1)
Malesfish
```

 The p-value shown is 2.2e-16. Because of this it probably happened just due to chance.




```{r}
effect <- Malesfish$p.value/(Malesfish$p.value +1)
effectivenessMales = Malesfish$estimate/(Malesfish$estimate +1)*100
print(effectivenessMales)
```

```{r}
low=(Malesfish$conf.int[1]/(Malesfish$conf.int[1] +1))*100
hi=(Malesfish$conf.int[2]/(Malesfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`



The chart above shows the effectiveness of the COVID-19 vaccine in males. An effectiveness rate above 50% indicates that the vaccine offers protection. Based on the interval displayed, we can conclude that the vaccine is effective in reducing the risk of infection among males.

The odds ratio provides an estimate of the vaccine’s effectiveness. For males, the odds ratio is approximately 70, with a confidence interval ranging from 68.85 to 78.32.

## Females

### Barplot

```{r}
dd3 <- Female %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))
# the group_by followed by summarize(count=n())

basicC <- ggplot(dd3,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd3,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot illustrates the female population and their outcomes regarding COVID-19 contraction, based on whether they received the vaccine or a placebo. It shows that around 35% of those who were vaccinated still contracted COVID-19, whereas about 65% of those who received the placebo became infected. A significantly higher percentage of individuals who took the placebo contracted the virus compared to those who were vaccinated. These results suggest that the vaccine is effective in providing protection against COVID-19.  

#### Numerical Results 

```{r}
table2<- xtabs(~infected + treatment, data=Males)
rowPerc(table2)
colPerc(table2)
```

These figures show the percentages of females who contracted COVID-19 after receiving either the placebo or the vaccine. Among the female participants, 74% of those who took the placebo became infected, while only about 26% of those who received the vaccine contracted the virus. This data shows that the vaccine is effective in reducing the risk of COVID-19 in females and is therefore recommended.


##### Infrential Results

```{r}
chisq.test(table1)
chisqtestGC(table1)
Femalefish <- fisher.test(table1)
Femalefish
```

The p-value shown is v2.2e-16. Because of this it probably happened just due to chance.

```{r}
effect <- Femalefish$p.value/(Femalefish$p.value +1)
effectivenessFemales = Femalefish$estimate/(Femalefish$estimate +1)*100
print(effectivenessFemales)
```

```{r}
low=(Femalefish$conf.int[1]/(Femalefish$conf.int[1] +1))*100
hi=(Femalefish$conf.int[2]/(Femalefish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`



The chart above shows the effectiveness of the COVID-19 vaccine in females. An effectiveness rate above 50% indicates that the vaccine offers protection. Based on the interval displayed, we can conclude that the vaccine is effective in reducing the risk of infection among females.

The odds ratio provides an estimate of the vaccine’s effectiveness. For females, the odds ratio is approximately 74, with a confidence interval ranging from 68.85 to 78.32.

## LGBTQ

### Barplot

```{r}
dd4 <- gay %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))
# the group_by followed by summarize(count=n())

basicC <- ggplot(dd4,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd4,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot illustrates the gay population and their outcomes regarding COVID-19 contraction, based on whether they received the vaccine or a placebo. It shows that around 20% of those who were vaccinated still contracted COVID-19, whereas about 80% of those who received the placebo became infected. A significantly higher percentage of individuals who took the placebo contracted the virus compared to those who were vaccinated. These results suggest that the vaccine is effective in providing protection against

#### Numerical Results

```{r}
table3 <- xtabs(~infected + treatment, data=gay)
rowPerc(table3)
colPerc(table3)
```

These figures show the percentages of gay individuals who contracted COVID-19 after receiving either the placebo or the vaccine. Among this group, 80% of those who took the placebo became infected, while only about 20% of those who received the vaccine contracted the virus. This data shows that the vaccine is effective in reducing the risk of COVID-19 in gay individuals and is therefore recommended.

##### Infrential Results

```{r}
chisq.test(table3)
chisqtestGC(table3)
gayfish <- fisher.test(table3)
gayfish
```

 The p-value shown is 7e-07. Because of this it probably happened just due to chance.

```{r}
effect <- gayfish$p.value/(gayfish$p.value +1)
effectivenessgay = gayfish$estimate/(gayfish$estimate +1)*100
print(effectivenessgay)
```

```{r}
low=(gayfish$conf.int[1]/(gayfish$conf.int[1] +1))*100
hi=(gayfish$conf.int[2]/(gayfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`

The chart above shows the effectiveness of the COVID-19 vaccine in gay individuals. An effectiveness rate above 50% indicates that the vaccine offers protection. Based on the interval displayed, we can conclude that the vaccine is effective in reducing the risk of infection among this group.

The odds ratio provides an estimate of the vaccine’s effectiveness. For gay individuals, the odds ratio is approximately 80, with a confidence interval ranging from 68.99 to 89.88.


## Druggies

```{r}
dd5 <- Druguser %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))
# the group_by followed by summarize(count=n())

basicC <- ggplot(dd5,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd5,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot illustrates the population of drug users and their outcomes regarding COVID-19 contraction, based on whether they received the vaccine or a placebo. It shows that around 95% of those who were vaccinated still contracted COVID-19, whereas only about 8% of those who received the placebo became infected. A significantly higher percentage of individuals who received the vaccine contracted the virus compared to those who took the placebo. These results suggest that, in this group, the vaccine appears to be ineffective in providing protection against COVID-19.

#### Numerical Results 


```{r}
table4<- xtabs(~infected + treatment, data=Druguser)
rowPerc(table4)
colPerc(table4)
```
These figures show the percentages of drug users who contracted COVID-19 after receiving either the placebo or the vaccine. Among this group, 8.3% of those who took the placebo became infected, while approximately 91.7% of those who received the vaccine contracted the virus. This data indicates that the vaccine is ineffective in preventing COVID-19 among drug users and is therefore not recommended. Those who received the vaccine were more likely to contract the virus.

##### Infrential Results 

```{r}
chisq.test(table4)
chisqtestGC(table4)
Druguserfish <- fisher.test(table4)
Druguserfish
```

The p-value is at 3e-12. With how small the number is, the results most likely didn't happen by chance.

```{r}
effect <- Druguserfish$p.value/(Druguserfish$p.value +1)
effectivenessDruguser = Druguserfish$estimate/(Druguserfish$estimate +1)*100
print(effectivenessDruguser)
```

```{r}
low=(Druguserfish$conf.int[1]/(Druguserfish$conf.int[1] +1))*100
hi=(Druguserfish$conf.int[2]/(Druguserfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`

The chart above shows the effectiveness of the COVID-19 vaccine in drug users. An effectiveness rate above 50% indicates that the vaccine is effective. Based on the interval displayed, we can conclude that the vaccine is ineffective in protecting drug users from contracting COVID-19.

The odds ratio provides an estimate of the vaccine’s effectiveness. For drug users, the odds ratio is approximately 7, with a confidence interval ranging from 2.65 to 17.86.

# Overall Results and Conclusions

The COVID-19 vaccine was effective in protecting men against the contraction of the disease. The COVID-19 effectiveness was `r effectivenessMales` for men. 
The COVID-19 vaccine was successful in protecting women against COVID-19.The COVID-19 effectiveness was `r effectivenessFemales`.
The COVID-19 vaccine was most effective in treating people who identified as gay. The COVID-19 effectiveness was `r effectivenessgay` for gay individuals.
The individuals that used drugs were ineffectively protected by the vaccine. 
The people who used drugs that took the vaccine were more likely to get COVID-19 than those taking the placebo.The COVID-19 effectiveness was `r effectivenessDruguser` for drug users.

If you are drug user it is not recommended to receive the vaccine. However, if you are gay, female or male and don't use them, the vaccine was effective.
The null is that there is no difference in taking the vaccine can not be accepted to the categories including drug users. The alternative, that the vaccine works and is effective, can be accepted for the women, men,and the people who are gay.